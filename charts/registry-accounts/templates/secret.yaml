{{- if .Values.registries }} 
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.secretName | default "registry-secrets" }}
type: kubernetes.io/dockerconfigjson
data:
  # .dockerconfigjson must be a base64â€‘encoded JSON document.
  .dockerconfigjson: |
    {{- $auths := dict -}}
    {{- range .Values.registries }}
      {{- $username := .username | default "oauth2" -}}
      {{- $auth := printf "%s:%s" $username .password | b64enc -}}
      {{- $_ := set $auths .server (dict "auth" $auth) -}}
    {{- end }}
    {{- $dockerConfig := dict "auths" $auths | toJson | b64enc -}}
    {{ $dockerConfig }}
{{- end }}