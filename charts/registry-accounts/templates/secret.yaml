{{- if .Values.registries }} 

{{- $auths := dict -}}
{{- range .Values.registries }}
  {{- $username := .username | default "oauth2" -}}
  {{- $auth := printf "%s:%s" $username .password | b64enc -}}
  {{- $_ := set $auths .server (dict "username" $username "password" .password "auth" $auth) -}}
{{- end }}

{{- $dockerConfig := dict "auths" $auths | toJson | b64enc }}

apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.secretName | default "registry-secrets" }}
type: kubernetes.io/dockerconfigjson
data:
  # The secret value must be a base64â€‘encoded JSON document.
  .dockerconfigjson: {{ $dockerConfig }}

{{- end }}