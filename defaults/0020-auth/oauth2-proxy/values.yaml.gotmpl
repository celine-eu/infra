# Oauth client configuration specifics
config:
  existingSecret: oauth2-proxy-secret
  existingConfig: oauth2-proxy-config

initContainers:
  waitForRedis:
    enabled: false

# Configure the session storage type, between cookie and redis
sessionStorage:
  # Can be one of the supported session storage cookie|redis
  type: redis
  redis:
    # existingSecret: ""
    # passwordKey: "redis-password"
    clientType: "standalone"
    standalone:
      # URL of redis standalone server for redis session storage (e.g. `redis://HOST[:PORT]`). Automatically generated if not set
      connectionUrl: "redis://redis:6379"

extraEnv:
{{- if .Environment.Values.tls_setup.self_signed }}
  - name: OAUTH2_PROXY_LOG_LEVEL
    value: debug
  - name: SSL_CERT_FILE
    value: /etc/ssl/celine-ca/ca.crt
  - name: OAUTH2_PROXY_PROVIDER_CA_FILES
    value: /etc/ssl/celine-ca/ca.crt
{{- else }}
  - name: OAUTH2_PROXY_LOG_LEVEL
    value: info
{{- end }}

{{- if .Environment.Values.tls_setup.self_signed }}
extraVolumes:
  - name: celine-ca
    secret:
      secretName: {{ .Environment.Values.tls_setup.ca_secret | default "" }}
      items:
        - key: ca.crt
          path: ca.crt

extraVolumeMounts:
  - name: celine-ca
    mountPath: /etc/ssl/celine-ca
    readOnly: true
{{- end }}

ingress:
  enabled: true
  className: nginx
  path: /
  pathType: ImplementationSpecific
  hosts:
    - sso.{{ .Environment.Values.domain }}
  # Extra paths to prepend to every host configuration. This is useful when working with annotation based services.
  # Warning! The configuration is dependant on your current k8s API version capabilities (networking.k8s.io/v1)
  # extraPaths:
  # - path: /*
  #   pathType: ImplementationSpecific
  #   backend:
  #     service:
  #       name: ssl-redirect
  #       port:
  #         name: use-annotation
  labels: {}
  annotations:
    cert-manager.io/issuer: {{ .Environment.Values.tls_setup.issuer | default "celine-tls" }}
  #   kubernetes.io/ingress.class: nginx
  #   kubernetes.io/tls-acme: "true"
  tls:
    - secretName: oauth2-proxy-tls
      hosts:
        - "sso.{{ .Environment.Values.domain }}"
